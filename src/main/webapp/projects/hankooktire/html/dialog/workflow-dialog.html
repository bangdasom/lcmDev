<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>DWP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="../../assets/css/components-style.css"/>
    <link rel="stylesheet" href="../../assets/css/pages.css"/>
    <link rel="stylesheet" href="../../assets/css/pages-m.css"/>

    <script src="../../assets/lib/jquery/jquery-2.2.4.js"></script>
    <script src="../../assets/lib/jquery-ui/jquery-ui.min.js"></script>
    <script src="../../assets/lib/slick/slick.min.js"></script>
    <script src="../../assets/lib/bxSlider/jquery.bxslider.min.js"></script>
    <script src="../../assets/lib/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="../../assets/js/common-style.js"></script>
    <script src="../../assets/js/sub-layout.js"></script>
    <script src="../../assets/js/common-dialog.js"></script>
    <script src="../../assets/js/dynatree/jquery.dynatree.js"></script>
    <script>
        $(function() {
            $("#dialog").dialog({
                title: "Workflow",
                width: 736,
                height: 600,
                /* 기본옵션 */
                modal: true,
                draggable: false,
                hide: { effect: "fade", duration: 300 },
                show: { effect: "fade", duration: 300 },
                resizable: true,
                open: function() {
                    /* 검은막 클릭시 dialog 닫힘 */
                    $('.ui-widget-overlay').on('click', function() {
                        $('#dialog').dialog('close');
                    });

                    /* 왼쪽 트리 */
                    if($("#tree .dynatree-container").length < 1) {
                        $("#tree").dynatree({
                            checkbox:true,
                            clickFolderMode: 1,
                            initAjax: {
                                url: "../../assets/js/dynatree/sampjson2.json"
                            },
                            helper: "clone",
                            dnd: {
                                /* 폴더는 드래그 안되게 */
                                onDragStart: function(node) {
                                    if(node.data.isFolder){
                                        return false;
                                    }
                                    return true;
                                }
                            }
                        });
                    }

                    /* 드래그 앤 드랍 */
                    if(!$(".dwp-list-body").hasClass(".ui-droppable")) {
                        $(".dwp-list-body").droppable({
                            hoverClass: "drophover",
                            addClasses: true,
                            over: function(event, ui) {
                                logMsg("droppable.over, %o, %o", event, ui);
                            },
                            drop: function(event, ui) {
                                addMember();
                            }
                        });
                    }
                }
            });

            /* 추가 버튼 클릭시 */
            $(document).on("click", ".btn-add", function() {
                addMember();
            });

            /* 삭제 버튼 클릭시 */
            $(document).on("click", ".btn-del", function() {
                $(".dwp-list-body .dwp-item.active").remove();
            });

            /* X 버튼 클릭시 */
            $(document).on("click", ".dwp-list-body .dwp-item .btn-cancel", function() {
                $(this).closest(".dwp-item").remove();
            });

            /* 전체삭제 버튼 클릭시 */
            $(document).on("click", ".btn-all-del", function() {
                $(".dwp-list-body .dwp-item").remove();
            });

            /* 오른쪽 영역의 아이템 클릭시 표시 */
            $(document).on("click", ".dwp-list-body .dwp-item", function() {
                $(this).toggleClass("active");
            });

            /* 오른쪽 영역으로 멤버 추가 함수 */
            function addMember() {
                var target = $(".dwp-list-body");
                var selected = $("#tree").dynatree("getSelectedNodes");

                for(var i = 0; i < selected.length; i++) {
                    var key = selected[i].data.key;
                    var title = selected[i].data.title;
                    var item =  "<div class='dwp-item' data-key='"+key+"'>";
                    item += title;
                    item += "<button type='button' class='btn-cancel'>삭제</button>";
                    item += "</div>";

                    if(!selected[i].data.isFolder) {
                        var flag = false;

                        /* 중복검사 */
                        $(".dwp-list-body .dwp-item").each(function() {
                            var selKey = $(this).attr("data-key");
                            if(selKey == key) {
                                flag = true;
                            }
                        });

                        if(!flag) {
                            target.append(item);
                        }
                    }
                }
            }
        });
    </script>

</head>
<body>
    <div id="dialog" title="Basic dialog">
        <div class="dwp-workflow-dialog dwp-namepicker">
            <div class="dwp-tabs">
                <ul class="dwp-tabs-header">
                    <li><a href="#dwp-tabs-content">결재선</a></li>
                    <li><a href="#dwp-tabs-content">주관부서</a></li>
                    <li><a href="#dwp-tabs-content">수신부서</a></li>
                </ul>
                <div class="dwp-tabs-content" id="dwp-tabs-content">

                    <div class="dwp-namepicker-inner">

                        <!-- 왼쪽 트리 -->
                        <div class="dwp-tree-area">
                            <div class="dwp-search-area">
                                <div class="dwp-search-bar">
                                    <input type="text">
                                    <div class="dwp-btn icon"><button type="button"><img src="../../assets/images/common/icon-search.svg" alt=""></button></div>
                                </div>
                                <div class="dwp-btn icon">
                                    <button type="button"><img src="../../assets/images/common/icon-refresh.svg" alt=""></button>
                                </div>
                            </div>

                            <div class="dwp-tree">
                                <div id="tree"></div>
                            </div>
                        </div>

                        <!-- 버튼 영역 -->
                        <div class="dwp-btn-area">
                            <div class="dwp-btn btn-add"><button type="button">추가</button></div>
                            <div class="dwp-btn btn-del"><button type="button" class="btn-del">삭제</button></div>
                            <div class="dwp-btn btn-all-del"><button type="button">모두삭제</button></div>
                        </div>

                        <!-- 오른쪽 영역 -->
                        <div class="dwp-form-area">
                            <div class="dwp-list-head">부서</div>
                            <div class="dwp-list-body">
                                <div class="dwp-item">기본형</div>
                                <div class="dwp-item active">active 클래스 추가<button type="button" class="btn-cancel">삭제</button></div>
                                <div class="dwp-item is-folder">is-folder 클래스 추가</div>
                                <div class="dwp-item is-folder active">is-folder, active 클래스 추가</div>
                                <div class="dwp-item org-type">org-type 클래스 추가</div>
                                <div class="dwp-item org-type active">org-type, active 클래스 추가</div>
                                <div class="dwp-item org-type is-folder">org-type, is-folder 클래스 추가</div>
                                <div class="dwp-item org-type is-folder active">org-type, is-folder, active 클래스 추가</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="aligner" data-top="md" data-type="table">
            <div class="center">
                <div class="dwp-grouping">
                    <div class="dwp-btn confirm"><button type="button">확인</button></div>
                    <div class="dwp-btn cancel"><button type="button">취소</button></div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
