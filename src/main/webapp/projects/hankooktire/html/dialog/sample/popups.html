<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>DWP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="../../../assets/css/components-style.css"/>
    <link rel="stylesheet" href="../../../assets/css/pages.css"/>
    <link rel="stylesheet" href="../../../assets/lib/jquery-ui/jquery-ui.min.css"/>

    <script src="../../../assets/lib/jquery/jquery-2.2.4.js"></script>
    <script src="../../../assets/lib/jquery-ui/jquery-ui.min.js"></script>
    <script src="../../../assets/js/common-style.js"></script>
    <script src="../../../assets/js/sub-layout.js"></script>
    <!--<script src="../../../assets/js/common-dialog.js"></script>-->
    <script src="../../../assets/js/dialog-sep/modal.js"></script>
    <script src="../../../assets/js/dialog-sep/bizcard.js"></script>
    <script src="../../../assets/js/dialog-sep/hk_dialog.js"></script>
    <script src="../../../assets/js/dialogs-case.js"></script>
    <script>
        $(document).ready(function(){
            /* 북마크 공유 팝업 */
            $(".reg-test").on("click", function () {
                $("body").regtest({
                    ajaxOpts:{
                        url:$(this).attr("url")
                    },
                    doSomething:call
                });
            });
        });

        var call = function(){
            console.log("test");
        };

        $(function(){
            $.numericToCurrency  = function(currency){
                var parts = currency.toString().split(".");
                parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                return parts.join(".");
            }
            $.currencyToNumeric= function(currency){
                var parts = currency.toString().split(".");
                parts[0] = parts[0].replace(/[^\d]+/g, '');
                return parts.join(".");
            }
            $.fn.inputValidation = function(){
                $(this).find("input").each(function(){
                    if($(this).hasClass("num-type")){
                        $(this).css("text-align","right");
                        var regExp = /^[0-9\-]+$/;
                        $(this).keyup(function(){
                            console.log("num");
                            if(!regExp.test($(this).val())){
                                $(this).val($(this).val().slice(0,-1));
                                $(this).focus();
                            }
                        });
                    }else if($(this).hasClass("en-type")){

                        var regExp = /^[a-zA-Z]+$/;
                        $(this).keyup(function(){
                            if(!regExp.test($(this).val())){
                                $(this).val($(this).val().slice(0,-1));
                            }
                        });
                    }else if($(this).hasClass("email-type")){
                        var regExp = /^[0-9a-zA-Z]([\-.\w]*[0-9a-zA-Z\-_+])*@([0-9a-zA-Z][\-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9}$/;
                        $(this).focusout(function(){
                           if(!regExp.test($(this).val())){
                                $(this).val("");
                                $(this).focus();
                           }
                        });
                    }else if($(this).hasClass("numeric-type")){
                        $(this).css("text-align","right");
                        var regExp = /^[0-9\,]+\b[\.]?[0-9]*$/;
                        $(this).keyup(function(){
                            if(!regExp.test($(this).val())){
                                $(this).val($(this).val().slice(0,-1));
                            }else{
                                var currency = $.currencyToNumeric($(this).val());
                                currency = $.numericToCurrency(currency);
                                $(this).val(currency);
                            }
                        });
                    }
                });
            };

            $.widget( "dwp.regtest", $.ui.dialog, {
                options: {
                    show:{ effect: "fade", duration: 300 },
                    hide:{ effect: "fade", duration: 300 },
                    autoOpen:true,
                    case:null,
                    ajaxOpts:{
                        success:function(data){
                            $("#regtest").html(data);
                        }
                    }
                },
                beforeCreateLoadContent:function(){
                    $("body").append('<div id="regtest" title="Basic title"></div>');
                    this.element = $("#regtest");
                    var copyOpts = this.options.ajaxOpts;
                    copyOpts.async = false;
                    $.ajax(copyOpts);
                },
                _innerCase: function () {
                    var case_options = {};
                    var current = this;
                    case_options = {
                        modal: true,
                        draggable: false,
                        title: "북마크 공유하기",
                        hide: { effect: "fade", duration: 300 },
                        show: { effect: "fade", duration: 300 },
                        resizable: false,
                        open: function() {
                            $(this).closest(".ui-dialog").siblings('.ui-widget-overlay').on('click', function() {
                                current.close();
                            });
                        },
                        ajaxOpts: {
                            success: function (data) {
                                $("#regtest").html(data);
                            }
                        }
                    };
                    $.extend(true,this.options,case_options);
                    $("#regtest").prev().children(".ui-dialog-title").text(this.options.title);

                    var current = this;
                    $.ajax(current.options.ajaxOpts).done(function(){
                        console.log();

                        $(current.element).inputValidation();

                        if(typeof current.options.doSomething == 'function'){
                            current._trigger("regtest");
                        }
                    });
                },
                _create:function(){
                    this.beforeCreateLoadContent();
                    this._super();
                },
                open:function(){
                    this._innerCase();
                    this._super();
                }
            });
        });



    </script>
</head>
<body style="padding: 30px;">

<div class="dwp-btn-group">
    <!-- 팝업버튼 -->
    <div class="dwp-btn"><button class="bookmark-btn" type="button">북마크 첨부 팝업</button></div>

</div>

<div style="position: absolute; top: 80%; left:10%;">
    <div class="dwp-btn"><button class="reg-test" url="regtest.html" type="button">regtest</button></div>
</div>

<div style="position: absolute; top: 20%; left:90%;">
    <div class="dwp-btn">
        <div class="docs-value">
            <div class="dwp-btn icon">
                <button type="button" class="view-setting-btn" data="view-setting-dialog.html">
                    <img src="../../../assets/images/common/icon-setting.svg" alt="">
                </button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
