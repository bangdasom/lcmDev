<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>DWP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="../../assets/css/components-style.css"/>
    <link rel="stylesheet" href="../../assets/css/pages.css"/>
    <link rel="stylesheet" href="../../assets/css/pages-m.css"/>

    <script src="../../assets/lib/jquery/jquery-2.2.4.js"></script>
    <script src="../../assets/lib/jquery-ui/jquery-ui.min.js"></script>
    <script src="../../assets/lib/slick/slick.min.js"></script>
    <script src="../../assets/lib/bxSlider/jquery.bxslider.min.js"></script>
    <script src="../../assets/lib/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="../../assets/js/common-style.js"></script>
    <script src="../../assets/js/sub-layout.js"></script>
    <script src="../../assets/js/common-dialog.js"></script>
    <script src="../../assets/js/dynatree/jquery.dynatree.js"></script>
    <script>
        $(function() {
            $("#dialog").dialog({
                title: "메모장",
                width: 736,
                height: 885,
                dialogClass: "bg-gray",

                /* 기본옵션 */
                draggable: false,
                hide: { effect: "fade", duration: 300 },
                show: { effect: "fade", duration: 300 },
                modal: true,
                resizable: false,
                open: function() {
                    $('.ui-widget-overlay').on('click', function() {
                        $('#dialog').dialog('close');
                    })
                }
            });

            $('.memo-contents').mCustomScrollbar({
                theme: 'dark-3',
                scrollbarPosition: "outside"
            });

            /* drag n drop 관련 */
            $(".memo-container").sortable({
                connectWith: ".memo-container",
                placeholder: "portlet-placeholder",
                scroll: true,
                start: function(e, ui) {
                    ui.placeholder.height(ui.item.outerHeight() - 9);
                },
                change: function(e, ui) {
                },
                stop: function(e, ui) {
                    ui.item.removeClass('hover');
                }
            });

            /* 수정시 */
            $(document).on("click", ".memo-item .btn-modify", function() {
                var current = $(this);
                var title = lineAlignmentForTextArea($(this).parent().siblings(".title").html());
                var article = lineAlignmentForTextArea($(this).parent().siblings(".article").html());

                $(".modify-area .input-title textarea").val(title);
                $(".modify-area .input-article textarea").val(article);
                $(".modify-area").addClass("active");

                autoSize();

                $('.modify-form .dwp-btn').off().on("click",function(){
                    var title = lineAlignmentForHtml($(this).closest('.aligner').siblings('.input-title').find('textarea').val());
                    var article = lineAlignmentForHtml($(this).closest('.aligner').siblings('.input-article').find('textarea').val());
                    current.parent().siblings('.title').html(title);
                    current.parent().siblings('.article').html(article);
                    $(".modify-area").removeClass("active");
                });
            });

            $(document).on("click", ".modify-area", function() {
                $(this).removeClass("active");
            });

            $(document).on("click", ".modify-form", function(e) {
                e.stopPropagation();
            });

            $(document).on("click",'.btn-wrap .btn-delete',function(){
                $(this).closest('.memo-item').remove();
            });

            $(document).on("click",".article-save",function(){
                var title = lineAlignmentForHtml($(".input-form .input-title textarea").val());
                var article = lineAlignmentForHtml($(".input-form .input-article textarea").val());
                setMemo(title,article);
            });

            autoSize();
        });

        function autoSize(){
            $('.dwp-textarea').on( 'keyup', 'textarea', function (e){
                $(this).css('height', 'auto' );
                $(this).height( this.scrollHeight );
            });
            $('.dwp-textarea').find( 'textarea' ).keyup();
        }

        function lineAlignmentForHtml(str){
            return str.split('\n').join('<br>');
        }
        function lineAlignmentForTextArea(str){
            return str.split('<br>').join('\n');
        }

        function setMemo(title,article){
            var compare = 99999;
            var $position = null;
            $(".memo-container").each(function(){
                var height = 0;
                $(this).children(".memo-item").each(function(){
                    height += $(this).height();
                });
                if(compare >= height){
                    compare = height;
                    $position = $(this);
                }
            });

            var html = '<div class="memo-item ui-sortable-handle">'
            html+= '<div class="title">'+title+'</div>';
            html+= '<div class="article">'+article+'</div>';
            html+= '<div class="btn-wrap">';
            html+= '<a class="btn-modify"><img src="../../assets/images/common/icon-modify-md.svg" alt="" class="mCS_img_loaded"></a>';
            html+= '<a class="btn-delete"><img src="../../assets/images/common/icon-close-md.svg" alt="" class="mCS_img_loaded"></a>';
            html+= '</div>';
            html+= '</div>';

            $position.append(html);
        }

    </script>
</head>
<body>
<div id="dialog" title="Basic dialog">
    <div class="dwp-memopad-dialog">

        <!-- 수정시 보여지는 영역 -->
        <div class="modify-area">
            <div class="modify-form">
                <div class="input-title">
                    <div class="dwp-textarea">
                        <textarea></textarea>
                    </div>
                </div>
                <div class="input-article">
                    <div class="dwp-textarea">
                        <textarea></textarea>
                    </div>
                </div>
                <div class="aligner" data-top="xs">
                    <div class="right">
                        <div class="dwp-btn"><button type="button">수정</button></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="memo-contents">
            <div class="input-area">
                <div class="search-form">
                    <div class="dwp-selectbox md">
                        <select>
                            <option value="">전체</option>
                            <option value="">옵션2</option>
                            <option value="">옵션3</option>
                        </select>
                    </div>
                    <div class="dwp-search-bar">
                        <input type="text">
                        <div class="dwp-btn icon"><button type="button"><img src="../../assets/images/common/icon-search.svg" alt=""></button></div>
                    </div>
                </div>
                <div class="input-form">
                    <div class="input-title">
                        <div class="dwp-textarea">
                            <textarea cols="30" rows="1" placeholder="제목"></textarea>
                        </div>
                    </div>
                    <div class="input-article">
                        <div class="dwp-textarea">
                            <textarea cols="30" rows="1" placeholder="메모작성..."></textarea>
                        </div>
                    </div>
                    <div class="aligner" data-top="xs">
                        <div class="right">
                            <div class="dwp-btn article-save"><button type="button">완료</button></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="memo-area">
                <div class="memo-container">
                    <div class="memo-item">
                        <div class="title">제목이 보이는 영역입니다.</div>
                        <div class="article">내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.</div>
                        <div class="btn-wrap">
                            <a class="btn-modify"></a>
                            <a class="btn-delete"><img src="../../assets/images/common/icon-close-md.svg" alt=""></a>
                        </div>
                    </div>
                </div>
                <div class="memo-container">
                    <div class="memo-item">
                        <div class="title">제목이 보이는 영역입니다.</div>
                        <div class="article">내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.</div>
                        <div class="btn-wrap">
                            <a class="btn-modify"><img src="../../assets/images/common/icon-modify-md.svg" alt=""></a>
                            <a class="btn-delete"><img src="../../assets/images/common/icon-close-md.svg" alt=""></a>
                        </div>
                    </div>
                    <div class="memo-item">
                        <div class="title">제목이 보이는 영역입니다.</div>
                        <div class="article">내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/>내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/>  </div>
                        <div class="btn-wrap">
                            <a class="btn-modify"><img src="../../assets/images/common/icon-modify-md.svg" alt=""></a>
                            <a class="btn-delete"><img src="../../assets/images/common/icon-close-md.svg" alt=""></a>
                        </div>
                    </div>
                </div>
                <div class="memo-container">
                    <div class="memo-item">
                        <div class="title">제목이 보이는 영역입니다.</div>
                        <div class="article">내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> 내용이 보여지는 영역입니다.<br/> .</div>
                        <div class="btn-wrap">
                            <a class="btn-modify"><img src="../../assets/images/common/icon-modify-md.svg" alt=""></a>
                            <a class="btn-delete"><img src="../../assets/images/common/icon-close-md.svg" alt=""></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
